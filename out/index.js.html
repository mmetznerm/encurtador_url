<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const express = require("express");
const mongodb = require("mongodb");
const server = express();
var dbo = null

var mongoClient = mongodb.MongoClient;
var url = "mongodb://localhost:27017/";

mongoClient.connect(url, function (err, db) {
    if (err) throw err;
    dbo = db.db("mydb");
});

server.use(express.json());
server.listen(3000, function () {
    console.log("Servidor rodando...");
});

/**
 * @typedef {Object} GetUrlsBetweenDates
 * @property {string}
 * 
 * Busca a lista de URLs no range entre a data de início e data fim
 * @param {Express.Request} req - Data inicial da pesquisa de URLs
 * @param {Express.Response} res - Data final da pesquisa de URLs
 * @returns {Promise&lt;GetUrlsBetweenDates>} - Retorna a lista de URLs no range das datas
 */
server.get('/urls', function (req, res) {
    const startDate = req.query.startDate
    const endDate = req.query.endDate

    dbo.collection("urls").find({
        "date": {
            $gte: startDate,
            $lt: endDate,
        }
    }).toArray(function (err, result) {
        if (err) throw err;
        return res.json(result);
    });
})

//Get a Url by ID
server.get('/url', function (req, res) {
    var ObjectId = mongodb.ObjectId
    var query = { _id: new ObjectId(req.query.id) };
    dbo.collection("urls").find(query).toArray(function (err, result) {
        if (err) throw err;
        return res.json(result);
    });
})

//Encode a URL
server.post('/url', function (req, res) {
    const { url } = req.body
    var encurtedUrl = "mm.z/" + generateCode()
    var myobj = { url: url, encurtedUrl: encurtedUrl, date: new Date() };
    dbo.collection("urls").insertOne(myobj, function (err, resp) {
        if (err) throw err;
        return res.json(encurtedUrl)
    });
});

/**
 * Gera um texto de caracteres aleatórios
 * @returns {string} - Retorna um texto com caracteres aleatórios]
 */
function generateCode() {
    let text = '';
    const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    for (let i = 0; i &lt; 5; i++)
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    return text;
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#generateCode">generateCode</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Wed Aug 31 2022 18:23:10 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
